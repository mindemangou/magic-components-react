"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react"),m=require("htmx.org"),p=require("./magiccomponentsreact.cjs"),S=(e,t)=>{const a=location.href,s=Object.fromEntries(new URL(location.toString()).searchParams.entries());let r=`?${new URLSearchParams({...s,...e}).toString()}`,n=location.hash;return t.length>0&&(n=`#${t}`),`${a}${r}${n}`},y=e=>{var t;const a={...e.dataset},s=Object.entries(a),r=new Map(s),n=e.querySelector("template");if(n){const o=(t=n==null?void 0:n.content.textContent)==null?void 0:t.trim(),c=o?JSON.parse(o):{};r.set("data",c)}return r.set("tagName",e.tagName.toLowerCase()),Object.fromEntries(r)},$=()=>{const e=l.useContext(p.MagicContext),[t,a]=l.useState({contextData:e,processing:!1,error:!1}),s=e.key,r=l.useCallback((o={},c="")=>{const i=e.tagName;if(s===void 0){console.warn(`You must add the data-key attribute on each ${i}`);return}a(u=>({...u,processing:!0}));const g=document.createElement("template");g.id=i,document.body.appendChild(g);const h=S(o,c),f=`${i}[data-key='${e.key}']`;m.ajax("GET",h,{target:`#${i}`,select:f,swap:"innerHTML"}).then(()=>{const u=g.firstElementChild,d=y(u);a(()=>({contextData:d,processing:!1,error:!1}))}).then(()=>{g.remove()}).catch(u=>{console.error(u),a(d=>({...d,processing:!1,error:!0}))})},[]),n=l.useCallback((o,c)=>{const i=document.querySelector(o);i&&m.trigger(i,"incoming_data",{tagName:o,data:c})},[]);return{...t.contextData,processing:t.processing,error:t.error,refresh:r,send:n}},x=()=>{const e=l.useContext(p.MagicContext),t=document.querySelector(e.tagName),[a,s]=l.useState([]);return t==null||t.addEventListener("incoming_data",r=>{const n=r,{elt:o,...c}=n.detail;s(()=>[...a,c])}),a};exports.useDataBag=x;exports.useMagicData=$;
