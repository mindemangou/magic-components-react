"use strict";var S=Object.create;var p=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var x=(t,e,a,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of $(e))!C.call(t,r)&&r!==a&&p(t,r,{get:()=>e[r],enumerable:!(n=v(e,r))||n.enumerable});return t};var f=(t,e,a)=>(a=t!=null?S(w(t)):{},x(e||!t||!t.__esModule?p(a,"default",{value:t,enumerable:!0}):a,t));Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react"),h=require("./magiccomponentsreact.cjs");new IntersectionObserver((t,e)=>{var a;for(const n of t)n.isIntersecting&&((a=n==null?void 0:n.target)==null||a.setAttribute("data-render","true"),e.unobserve(n.target))});const N=(t,e="")=>{const a=location.origin,n=location.pathname,r=Object.fromEntries(new URL(location.toString()).searchParams.entries());let c=`?${new URLSearchParams({...r,...t}).toString()}`,o=location.hash;return e.length>0&&(o=`#${e}`),`${a}${n}${c}${o}`},D=t=>{var e;const a={...t.dataset},n=Object.entries(a).map(o=>{const[s,i]=o;try{return i?[s,JSON.parse(i)]:[s,i]}catch{return[s,i]}}),r=new Map(n),c=t.querySelector("template");if(c){const o=(e=c==null?void 0:c.content.textContent)==null?void 0:e.trim(),s=o?JSON.parse(o):{};r.set("data",s)}return r.set("tagName",t.tagName.toLowerCase()),Object.fromEntries(r)},k=()=>{const t=l.useContext(h.MagicContext),[e,a]=l.useState({contextData:t,processing:!1,error:!1}),n=t.key,r=l.useCallback(async(o={},s="")=>{const{ajax:i}=(await import("htmx.org")).default,u=t.tagName;if(n===void 0){console.warn(`You must add the data-key attribute on each ${u}`);return}a(g=>({...g,processing:!0}));const d=document.createElement("template");d.id=u,document.body.appendChild(d);const y=N(o,s),b=`${u}[data-key='${t.key}']`;return i("get",y,{target:`#${u}`,select:b,swap:"innerHTML"}).then(()=>{const g=d.firstElementChild,m=D(g);a(()=>({contextData:m,processing:!1,error:!1}))}).then(()=>{d.remove()}).catch(g=>{console.error(g),a(m=>({...m,processing:!1,error:!0}))})},[]),c=l.useCallback(async(o,s)=>{const{trigger:i}=(await import("htmx.org")).default,u=document.querySelector(o);u&&i(u,"incoming_data",{tagName:o,data:s})},[]);return{...e.contextData,processing:e.processing,error:e.error,refresh:r,send:c}},M=()=>{const t=l.useContext(h.MagicContext),e=document.querySelector(t.tagName),[a,n]=l.useState([]);return e==null||e.addEventListener("incoming_data",r=>{const c=r,{elt:o,...s}=c.detail;n(()=>[...a,s])}),a};exports.useDataBag=M;exports.useMagicData=k;
