"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react"),m=require("htmx.org"),p=require("./magiccomponentsreact.cjs"),y=(t,e)=>{const a=location.origin,s=Object.fromEntries(new URL(location.toString()).searchParams.entries());let r=`?${new URLSearchParams({...s,...t}).toString()}`,n=location.hash;return e.length>0&&(n=`#${e}`),`${a}${r}${n}`},S=t=>{var e;const a={...t.dataset},s=Object.entries(a),r=new Map(s),n=t.querySelector("template");if(n){const o=(e=n==null?void 0:n.content.textContent)==null?void 0:e.trim(),c=o?JSON.parse(o):{};r.set("data",c)}return r.set("tagName",t.tagName.toLowerCase()),Object.fromEntries(r)},$=()=>{const t=l.useContext(p.MagicContext),[e,a]=l.useState({contextData:t,processing:!1,error:!1}),s=t.key,r=l.useCallback((o={},c="")=>{const i=t.tagName;if(s===void 0){console.warn(`You must add the data-key attribute on each ${i}`);return}a(u=>({...u,processing:!0}));const g=document.createElement("template");g.id=i,document.body.appendChild(g);const h=y(o,c),f=`${i}[data-key='${t.key}']`;m.ajax("GET",h,{target:`#${i}`,select:f,swap:"innerHTML"}).then(()=>{const u=g.firstElementChild,d=S(u);a(()=>({contextData:d,processing:!1,error:!1}))}).then(()=>{g.remove()}).catch(u=>{console.error(u),a(d=>({...d,processing:!1,error:!0}))})},[]),n=l.useCallback((o,c)=>{const i=document.querySelector(o);i&&m.trigger(i,"incoming_data",{tagName:o,data:c})},[]);return{...e.contextData,processing:e.processing,error:e.error,refresh:r,send:n}},x=()=>{const t=l.useContext(p.MagicContext),e=document.querySelector(t.tagName),[a,s]=l.useState([]);return e==null||e.addEventListener("incoming_data",r=>{const n=r,{elt:o,...c}=n.detail;s(()=>[...a,c])}),a};exports.useDataBag=x;exports.useMagicData=$;
