"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("react"),m=require("htmx.org"),p=require("./magiccomponentsreact.cjs");new IntersectionObserver((t,e)=>{var a;console.log("first");for(const r of t)r.isIntersecting&&((a=r==null?void 0:r.target)==null||a.setAttribute("data-render","true"),e.unobserve(r.target))});const S=(t,e="")=>{const a=location.origin,r=location.pathname,c=Object.fromEntries(new URL(location.toString()).searchParams.entries());let i=`?${new URLSearchParams({...c,...t}).toString()}`,n=location.hash;return e.length>0&&(n=`#${e}`),`${a}${r}${i}${n}`},b=t=>{var e;const a={...t.dataset},r=Object.entries(a).map(n=>{const[s,o]=n;try{return o?[s,JSON.parse(o)]:[s,o]}catch{return[s,o]}}),c=new Map(r),i=t.querySelector("template");if(i){const n=(e=i==null?void 0:i.content.textContent)==null?void 0:e.trim(),s=n?JSON.parse(n):{};c.set("data",s)}return c.set("tagName",t.tagName.toLowerCase()),Object.fromEntries(c)},v=()=>{const t=u.useContext(p.MagicContext),[e,a]=u.useState({contextData:t,processing:!1,error:!1}),r=t.key,c=u.useCallback((n={},s="")=>{const o=t.tagName;if(r===void 0){console.warn(`You must add the data-key attribute on each ${o}`);return}a(l=>({...l,processing:!0}));const g=document.createElement("template");g.id=o,document.body.appendChild(g);const h=S(n,s),f=`${o}[data-key='${t.key}']`;return m.ajax("get",h,{target:`#${o}`,select:f,swap:"innerHTML"}).then(()=>{const l=g.firstElementChild,d=b(l);a(()=>({contextData:d,processing:!1,error:!1}))}).then(()=>{g.remove()}).catch(l=>{console.error(l),a(d=>({...d,processing:!1,error:!0}))})},[]),i=u.useCallback((n,s)=>{const o=document.querySelector(n);o&&m.trigger(o,"incoming_data",{tagName:n,data:s})},[]);return{...e.contextData,processing:e.processing,error:e.error,refresh:c,send:i}},y=()=>{const t=u.useContext(p.MagicContext),e=document.querySelector(t.tagName),[a,r]=u.useState([]);return e==null||e.addEventListener("incoming_data",c=>{const i=c,{elt:n,...s}=i.detail;r(()=>[...a,s])}),a};exports.useDataBag=y;exports.useMagicData=v;
